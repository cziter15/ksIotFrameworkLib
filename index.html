<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Doxygen with github: ksIotFrameworkLib</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Doxygen with github
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ksIotFrameworkLib </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a> </p><blockquote class="doxtable">
<p>&zwj;Arduino Library for ESP32/ESP8266 - composition oriented internet of things framework that provides simple and extendable architecture, handles device setup (WiFi setup, MQTT and application specific configuration), network connectivity, MQTT telemetry protocol and more... </p>
</blockquote>
<p><a href="https://cziter15.github.io/ksIotFrameworkLib"><img src="https://img.shields.io/badge/Doxygen-2C4AA8?logo=doxygen&amp;style=for-the-badge" alt="Read the documentation" class="inline"/></a> <a href="https://github.com/cziter15/ksIotFrameworkLib/blob/master/LICENSE"><img src="https://img.shields.io/github/license/cziter15/ksIotFrameworkLib?style=for-the-badge" alt="License" class="inline"/></a></p>
<p><a href="https://platformio.org"><img src="https://img.shields.io/badge/works%20best%20with-PlatformIO-orange?logo=data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyB3aWR0aD0iMjUwMCIgaGVpZ2h0PSIyNTAwIiB2aWV3Qm94PSIwIDAgMjU2IDI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCI+PHBhdGggZD0iTTEyOCAwQzkzLjgxIDAgNjEuNjY2IDEzLjMxNCAzNy40OSAzNy40OSAxMy4zMTQgNjEuNjY2IDAgOTMuODEgMCAxMjhjMCAzNC4xOSAxMy4zMTQgNjYuMzM0IDM3LjQ5IDkwLjUxQzYxLjY2NiAyNDIuNjg2IDkzLjgxIDI1NiAxMjggMjU2YzM0LjE5IDAgNjYuMzM0LTEzLjMxNCA5MC41MS0zNy40OUMyNDIuNjg2IDE5NC4zMzQgMjU2IDE2Mi4xOSAyNTYgMTI4YzAtMzQuMTktMTMuMzE0LTY2LjMzNC0zNy40OS05MC41MUMxOTQuMzM0IDEzLjMxNCAxNjIuMTkgMCAxMjggMCIgZmlsbD0iI0ZGN0YwMCIvPjxwYXRoIGQ9Ik0yNDkuMzg2IDEyOGMwIDY3LjA0LTU0LjM0NyAxMjEuMzg2LTEyMS4zODYgMTIxLjM4NkM2MC45NiAyNDkuMzg2IDYuNjEzIDE5NS4wNCA2LjYxMyAxMjggNi42MTMgNjAuOTYgNjAuOTYgNi42MTQgMTI4IDYuNjE0YzY3LjA0IDAgMTIxLjM4NiA1NC4zNDYgMTIxLjM4NiAxMjEuMzg2IiBmaWxsPSIjRkZGIi8+PHBhdGggZD0iTTE2MC44NjkgNzQuMDYybDUuMTQ1LTE4LjUzN2M1LjI2NC0uNDcgOS4zOTItNC44ODYgOS4zOTItMTAuMjczIDAtNS43LTQuNjItMTAuMzItMTAuMzItMTAuMzJzLTEwLjMyIDQuNjItMTAuMzIgMTAuMzJjMCAzLjc1NSAyLjAxMyA3LjAzIDUuMDEgOC44MzdsLTUuMDUgMTguMTk1Yy0xNC40MzctMy42Ny0yNi42MjUtMy4zOS0yNi42MjUtMy4zOWwtMi4yNTggMS4wMXYxNDAuODcybDIuMjU4Ljc1M2MxMy42MTQgMCA3My4xNzctNDEuMTMzIDczLjMyMy04NS4yNyAwLTMxLjYyNC0yMS4wMjMtNDUuODI1LTQwLjU1NS01Mi4xOTd6TTE0Ni41MyAxNjQuOGMtMTEuNjE3LTE4LjU1Ny02LjcwNi02MS43NTEgMjMuNjQzLTY3LjkyNSA4LjMyLTEuMzMzIDE4LjUwOSA0LjEzNCAyMS41MSAxNi4yNzkgNy41ODIgMjUuNzY2LTM3LjAxNSA2MS44NDUtNDUuMTUzIDUxLjY0NnptMTguMjE2LTM5Ljc1MmE5LjM5OSA5LjM5OSAwIDAgMC05LjM5OSA5LjM5OSA5LjM5OSA5LjM5OSAwIDAgMCA5LjQgOS4zOTkgOS4zOTkgOS4zOTkgMCAwIDAgOS4zOTgtOS40IDkuMzk5IDkuMzk5IDAgMCAwLTkuMzk5LTkuMzk4em0yLjgxIDguNjcyYTIuMzc0IDIuMzc0IDAgMSAxIDAtNC43NDkgMi4zNzQgMi4zNzQgMCAwIDEgMCA0Ljc0OXoiIGZpbGw9IiNFNTcyMDAiLz48cGF0aCBkPSJNMTAxLjM3MSA3Mi43MDlsLTUuMDIzLTE4LjkwMWMyLjg3NC0xLjgzMiA0Ljc4Ni01LjA0IDQuNzg2LTguNzAxIDAtNS43LTQuNjItMTAuMzItMTAuMzItMTAuMzItNS42OTkgMC0xMC4zMTkgNC42Mi0xMC4zMTkgMTAuMzIgMCA1LjY4MiA0LjU5MiAxMC4yODkgMTAuMjY3IDEwLjMxN0w5NS44IDc0LjM3OGMtMTkuNjA5IDYuNTEtNDAuODg1IDIwLjc0Mi00MC44ODUgNTEuODguNDM2IDQ1LjAxIDU5LjU3MiA4NS4yNjcgNzMuMTg2IDg1LjI2N1Y2OC44OTJzLTEyLjI1Mi0uMDYyLTI2LjcyOSAzLjgxN3ptMTAuMzk1IDkyLjA5Yy04LjEzOCAxMC4yLTUyLjczNS0yNS44OC00NS4xNTQtNTEuNjQ1IDMuMDAyLTEyLjE0NSAxMy4xOS0xNy42MTIgMjEuNTExLTE2LjI4IDMwLjM1IDYuMTc1IDM1LjI2IDQ5LjM2OSAyMy42NDMgNjcuOTI2em0tMTguODItMzkuNDZhOS4zOTkgOS4zOTkgMCAwIDAtOS4zOTkgOS4zOTggOS4zOTkgOS4zOTkgMCAwIDAgOS40IDkuNCA5LjM5OSA5LjM5OSAwIDAgMCA5LjM5OC05LjQgOS4zOTkgOS4zOTkgMCAwIDAtOS4zOTktOS4zOTl6bS0yLjgxIDguNjcxYTIuMzc0IDIuMzc0IDAgMSAxIDAtNC43NDggMi4zNzQgMi4zNzQgMCAwIDEgMCA0Ljc0OHoiIGZpbGw9IiNGRjdGMDAiLz48L3N2Zz4=" alt="Build for PlatformIO" class="inline"/></a> <a href="https://hitsofcode.com/github/cziter15/ksIotFrameworkLib/view"><img src="https://hitsofcode.com/github/cziter15/ksIotFrameworkLib" alt="Hits-of-Code" class="inline"/></a> <a href="https://github.com/cziter15/ksIotFrameworkLib/commits/master"><img src="https://img.shields.io/github/commit-activity/m/cziter15/ksIotFrameworkLib" alt="Commit activity" class="inline"/></a></p>
<p><img src="https://github.com/cziter15/ksIotFrameworkLib/assets/5003708/a17e4fe9-144c-4422-be40-90e0f402b054" alt="image" class="inline"/></p>
<dl class="section important"><dt>Important</dt><dd>This library targets Arduino 3+ on ESP32. However, due to <a href="https://github.com/platformio/platform-espressif32/issues/1225">Platformio statement</a> it will not automatically pull latest versions. If you want latest version support, set your platform to pioarduino (by Jason2866) fork in your <code>platformio.ini</code> file.</dd></dl>
<div class="fragment"><div class="line">= https://github.com/pioarduino/platform-espressif32.git</div>
</div><!-- fragment --><dl class="section important"><dt>Important</dt><dd>When it comes to ESP8266, latest version supported is based on SDK305. To use it, add <code>-DPIO_FRAMEWORK_ARDUINO_ESPRESSIF_SDK305</code> to your build flags.</dd></dl>
<h1><a class="anchor" id="autotoc_md1"></a>
üå± Motivation</h1>
<ul>
<li>The goal of this project is to create a simple template or starting point to develop IoT applications using Espressif microcontrollers.</li>
<li>I was frequently copying and modifying source code for different devices and this is an attempt to streamline this process.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
üìö Doxygen</h1>
<ul>
<li>Detailed documentation can be found on <a href="https://cziter15.github.io/ksIotFrameworkLib">here</a>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
üîé Examples</h1>
<ul>
<li>Soome people prefer to learn by example. In this, open the [examples directory](examples).</li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
‚ÑπÔ∏è Architecture</h1>
<div class="fragment"><div class="line">flowchart TD</div>
<div class="line">    AppState{AppState}</div>
<div class="line">    AppState --&gt; |NotInitialized| Application::Init</div>
<div class="line">    AppState --&gt; |Initialized| Application::Loop</div>
<div class="line"> </div>
<div class="line">    subgraph Application::Init</div>
<div class="line">        A(Add initial components) --&gt;</div>
<div class="line">    B(Mark app state as initialized)</div>
<div class="line">    end</div>
<div class="line">   </div>
<div class="line">    subgraph Application::Loop</div>
<div class="line">        Loop{{For each component}} --&gt; CCS{State?}</div>
<div class="line"> </div>
<div class="line">        CCS --&gt; |Looping|LP1(Call component&#39;s loop)</div>
<div class="line">        CCS --&gt; |NotInitialized|LP2(Call component&#39;s init)</div>
<div class="line">        CCS --&gt; |Initialized|LP3(Call component&#39;s postInit)</div>
<div class="line">        CCS --&gt; |ToBeRemoved|LP4(Remove component)</div>
<div class="line"> </div>
<div class="line">    LP2 --&gt; SCS2(State -&gt; Initialized) --&gt; DF</div>
<div class="line">    LP3 --&gt; SCS3(State -&gt; Looping) --&gt; DF</div>
<div class="line">    LP1 --&gt; DF</div>
<div class="line"> </div>
<div class="line">        DF{Success?}</div>
<div class="line">        DF --&gt; |True|X0{{Continue}}</div>
<div class="line">        DF --&gt; |False|X1{{Break}}</div>
<div class="line"> </div>
<div class="line">    LP4 --&gt; Continue</div>
<div class="line">    end</div>
</div><!-- fragment --><ul>
<li>Only one application can be executed simultaneously.</li>
<li>Each application has its own components. Components are a key part of the framework.</li>
<li>Components have states. State change logic is handled in the application's loop.</li>
<li>Each component has init, postInit, and loop methods.</li>
<li>Components can be marked for removal, and they will be safely released in the next tick.</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
üìè Utilities</h1>
<p><img src="https://github.com/cziter15/ksIotFrameworkLib/assets/5003708/1b144cdf-e345-4865-8ae7-92f0eaf31992" alt="image" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md6"></a>
üî® Components</h1>
<p><img src="https://github.com/cziter15/ksIotFrameworkLib/assets/5003708/c27aba37-4e54-49f5-9ad5-97439e7baf33" alt="image" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md7"></a>
üîÖ Rules:</h2>
<ul>
<li>Components should be added in the app's <b>init</b> method, so they will be available for <b>postInit</b> methods. (you can add them later, in loop() but that's another case)</li>
<li>The <b>init</b> method is the best place to add dependent components, setup initial pin values etc.</li>
<li>The <b>postInit</b> method is the best place to obtain a weak pointer to another component by calling <b>findComponent</b>. This will handle cases when other components were added via init method.</li>
</ul>
<h1><a class="anchor" id="autotoc_md8"></a>
üå± Building the application</h1>
<p>To build an application, simply create a new class inherited from ksApplication and add your initial components inside the init method. See projects like <b>emon_fw</b> for reference.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
üîé How does it work under the hood?</h2>
<ul>
<li>The application is created, followed by the invocation of its init() method. If false is returned from the init method, the subsequent execution of the loop will be skipped, resulting in no iteration over the components. The App Rotator will then try to run next apllication.</li>
<li>In case the init() method returns true, the application proceeds to execute its loop() function. This function traverses through the components, initializing each of them.</li>
<li>In the subsequent iteration, the application triggers the postInitialize() method for each component.</li>
<li>Following this, the application is fully initialized and enters a looping state where it iterates over the components, invoking their respective loop methods.</li>
<li>If any component returns false during it's loop method, the application will break and the App Rotator will select the next application for execution.</li>
</ul>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">bool</span> PelletInfo::init()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Create required components (Wifi and Mqtt debug). */</span></div>
<div class="line">    addComponent&lt;ksf::comps::ksWifiConnector&gt;(PelletInfoConfig::pelletInfoDeviceName);</div>
<div class="line">    addComponent&lt;ksf::comps::ksMqttDebugResponder&gt;();</div>
<div class="line">    addComponent&lt;ksf::comps::ksDevStatMqttReporter&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create OTA updater component. */</span></div>
<div class="line">    addComponent&lt;ksf::comps::ksDevicePortal&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create state display and receiver components. */</span></div>
<div class="line">    addComponent&lt;comps::StateDisplay&gt;();</div>
<div class="line">    addComponent&lt;comps::StateReceiver&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create reset button component. */</span></div>
<div class="line">    addComponent&lt;ksf::comps::ksResetButton&gt;(CFG_PUSH_PIN, LOW);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create mqttConnector and statusLed components. */</span></div>
<div class="line">    addComponent&lt;ksf::comps::ksMqttConnector&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Application finished initialization, return true as it succedeed. */</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md10"></a>
üîÅ Application rotator</h1>
<p>The library implements one very useful utility named ksAppRotator. This object can wrap application instantiation logic into something like carousel or rotator.</p>
<p>Typically the device hosts two applications. First application is running core device logic while the second one is dedicated to help the user with the device configuration.</p>
<p>Each application has it's own loop method taking care of all underlying logic. In case of fail (which can happen anytime, even when creating the application object), the rotator will spawn next application and start processing it's logic until fail or break.</p>
<p>This is very flexible, because you can even raise fail (false) from application's init method and then go directly into the configuration mode (for example there's no WiFi credentials provided by the user).</p>
<h1><a class="anchor" id="autotoc_md11"></a>
üî£ Compiler flags</h1>
<ul>
<li>Bare Arduino projects need to have <code>gnu++2a</code> enabled via <code>compiler.cpp.extra_flags=</code> option in the <code>board.txt</code> file.</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
#Ô∏è‚É£ Custom RTTI</h1>
<ul>
<li>Use the KSF_RTTI_DECLARATIONS macro to provide proper runtime type information generation for proper casting of components.</li>
<li>See <a class="el" href="ks_config_provider_8h_source.html">ksConfigProvider.h</a> for an example. Your application components should use this macro, otherwise the component finding mechanism won't work.</li>
</ul>
<h1><a class="anchor" id="autotoc_md13"></a>
üî• Saving power</h1>
<ul>
<li>By default, this framework supports enables power saving for the modem.</li>
<li>Automatic modem sleep requires the DTIM to be set on the access point.</li>
<li>The best value for was 3. It allows the ESP32 to go down from around 100mA to 20mA.</li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
üìë Dependencies</h1>
<ul>
<li><b>It is highly recommended to use PlatformIO as it will automatically download dependencies!</b></li>
</ul>
<h2><a class="anchor" id="autotoc_md15"></a>
üî° Frameworks</h2>
<ul>
<li>Arduino for ESP32 [ <a href="https://github.com/espressif/arduino-esp32">https://github.com/espressif/arduino-esp32</a> ]</li>
<li>Arduino for ESP8266 [ <a href="https://github.com/esp8266/Arduino">https://github.com/esp8266/Arduino</a> ]</li>
</ul>
<h2><a class="anchor" id="autotoc_md16"></a>
üî° Libraries</h2>
<ul>
<li>PubSubClient [ <a href="https://github.com/knolleary/pubsubclient">https://github.com/knolleary/pubsubclient</a> ]</li>
<li>arduinoWebSockets [ <a href="https://github.com/Links2004/arduinoWebSockets">https://github.com/Links2004/arduinoWebSockets</a> ] </li>
</ul>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
